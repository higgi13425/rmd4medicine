---
title: "Response and adverse events to chemotherapy: A mock study"
author: 
- "Alison Hill, Ph.D."
- "Peter Higgins, MD, Ph.D."
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, collapse = TRUE)
```


```{r load-packages, include=FALSE}
library(arsenal) # for table one
library(janitor) # for tabyl
library(skimr) # for EDA
library(cowplot) # for multi-panel plot
library(readxl) # for data importing
library(here) # for file paths
library(infer) # for tidy statistics
library(tidyverse) # for all else
```


```{r import-data, include=FALSE}
mockdata <- read_xlsx(here("mockpaper/data/mockstudy_adverse.xlsx"))
```

# Basic sanity checking/EDA here


```{r}
glimpse(mockdata)

# skim(mockdata)

mockdata %>% 
  group_by(arm) %>% 
  skim()
```


# Make table one here

Let's make a basic Table 1 grouped by arm with details on sex and age in each group.

```{r results="asis"}
#summary by groups
tab1 <- tableby(arm ~ sex + age, data = mockdata)
summary(tab1, text=TRUE)
```

Let's make a Table 1 - but ungrouped, with stats on BMI, sex, Age in each group.

```{r results="asis"}
#summary without groups
tab.noby <- tableby(~ bmi + sex + age, data = mockdata)
summary(tab.noby)
```

Let's make a Table 1 but now control # of digits

```{r results="asis"}
summary(tableby(arm ~ sex + fu_time, data = mockdata), 
        digits = 4, digits.p = 2, digits.pct = 1)
```

# Run some stats and make a table here

Arm x fu_stat chi square table (1 = lived, 2 = died)

```{r}
mockdata %>% 
  tabyl(arm, fu_stat) %>% 
  adorn_totals("row") %>% # can also do "col", or c("row", "col")
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% 
  knitr::kable()
```


```{r}
mockdata %>% 
  specify(fu_stat ~ arm) %>% # alt: response = fu_stat, explanatory = arm
  calculate(stat = "Chisq")
```


```{r eval = FALSE}
mockdata %>% 
  specify(formula = fu_stat ~ arm, success = "1") %>% 
  hypothesize(null = "independence") %>% 
  generate(reps = 1000, type = "permute") %>% 
  calculate(stat = "diff in props", order = c("1", "2"))
```

make bar/lollipop chart of proportions here (% survived)

Then distribution plot of survival time (in days censored)

(for colors, maybe show `scale_fill_gray` + `scico`)

# Make a multi-panel plot here
